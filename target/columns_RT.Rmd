---
title: "RTs in columns"
output: html_document
---

```{r, fig.width=7, fig.height=5, warning=FALSE}
pth <- "//femsrv220.intra.ismaa.it/WATERS/experiments/AB6500_domenico2019/Grape_lipidomics_2019/2019_10_30/Results/SAMPLES_GRAPE_VAL/prove colonne/"
library(OrgMassSpecR)
library(RColorBrewer)

fl <- "C:/Users/garciaalom/Google Drive/projectes/lipidomics_shared/new_rt.xlsx"
cmps <- readxl::read_xlsx(fl, sheet = "FORMULE")
cmps_IS <- readxl::read_xlsx(fl, sheet = "IS")
cmps_IS <- cmps_IS[!is.na(cmps_IS$formula),]
cmps_IS_class <- readxl::read_xlsx(fl, sheet = "class_IS")
for(i in seq(nrow(cmps_IS))){
  cmps_IS$class[i] <- cmps_IS_class$class[cmps_IS$ID[i] == cmps_IS_class$IS]
}


cmps <- rbind(cmps[,c("ID", "formula", "class")], cmps_IS[,c("ID", "formula", "class")])

#col_class <- colorRampPalette(brewer.pal(12, "Paired"))(length(unique(cmps$class)))
col_class <- c(brewer.pal(12, "Paired"), brewer.pal(9, "Set1"))
#names(col_class) <- levels(factor((cmps$class)))
names(col_class) <- c("PC", "Lyso_PA", "Lyso_PE", "PG", "Lyso_PI", "Lyso_PS", "PA", "FFA", "Lyso_PG", "PE", "PI", "PS",
                      "CER", "CAR", "DAG", "DGDG", "Lyso_PC", "MAG", "MGDG", "SM", "TAG")
col_class[names(col_class) == "MAG"] <- "#FFD92F"
col_class[names(col_class) == "PI"] <- "#FFD92F"
#col_class[names(col_class) == "PE"] <- "#1F78B4"
#col_class[names(col_class) == "PG"] <- "#1F78B4"
plot(1,1)
legend("topright", legend = names(col_class), col = col_class, pch = 16, ncol = 2)

dt_AMIDE <- data.frame(rbind(c("FFA", 1, 350), 
                           c("Lyso_PA", 13, 360),
                           c("Lyso_PE", 11, 500),
                           c("Lyso_PG", 8, 550),
                           c("Lyso_PI", 13, 650),
                           c("Lyso_PS", 14.5, 490),
                           c("PA", 11, 600),
                           c("PC", 9, 800),
                           c("PE", 9.5, 630),
                           c("PG", 4, 850),
                           c("PI", 12.5, 850),
                           c("PS", 9.5, 870),
                           c("CAR", 11, 350),
                           c("CER", 4.5, 550),
                           c("DAG", 1, 650),
                           c("DGDG", 12.5, 980),
                           c("Lyso_PC", 14, 550),
                           c("MAG", 3.5, 410),
                           c("MGDG", 5.5, 750),
                           c("SM", 11, 750),
                           c("TAG", 1, 900)))
colnames(dt_AMIDE) <- c("name", "RT", "mass")
dt_AMIDE$color <- col_class[dt_AMIDE$name]


dt_BEH <- data.frame(rbind(c("FFA", 15, 250), 
                           c("Lyso_PA", 9, 360),
                           c("Lyso_PE", 12.5, 470),
                           c("Lyso_PG", 14, 540),
                           c("Lyso_PI", 6, 650),
                           c("Lyso_PS", 5, 450),
                           c("PA", 12, 650),
                           c("PC", 13, 800),
                           c("PE", 18, 630),
                           c("PG", 19.5, 750),
                           c("PI", 13, 850),
                           c("PS", 20, 870),
                           c("CAR", 3.5, 410),
                           c("CER", 14.5, 450),
                           c("DAG", 20, 500),
                           c("DGDG", 12, 950),
                           c("Lyso_PC", 8.5, 590),
                           c("MAG", 12.5, 350),
                           c("MGDG", 12, 800),
                           c("SM", 13, 700),
                           c("TAG", 23.5, 850)))
colnames(dt_BEH) <- c("name", "RT", "mass")
dt_BEH$color <- col_class[dt_BEH$name]

dt_CSH <- data.frame(rbind(c("FFA", 15, 250), 
                           c("Lyso_PA", 7, 360),
                           c("Lyso_PE", 12.5, 450),
                           c("Lyso_PG", 9, 550),
                           c("Lyso_PI", 6, 650),
                           c("Lyso_PS", 4, 550),
                           c("PA", 14, 600),
                           c("PC", 20, 800),
                           c("PE", 17, 600),
                           c("PG", 12.5, 700),
                           c("PI", 13, 800),
                           c("PS", 20, 870),
                           c("CAR", 3.5, 410),
                           c("CER", 18, 450),
                           c("DAG", 20, 550),
                           c("DGDG", 12.5, 950),
                           c("Lyso_PC", 8.5, 590),
                           c("MAG", 13, 350),
                           c("MGDG", 12, 800),
                           c("SM", 13, 700),
                           c("TAG", 23, 820)))
colnames(dt_CSH) <- c("name", "RT", "mass")
dt_CSH$color <- col_class[dt_CSH$name]


for(clm in c("AMIDE", "BEH", "CSH")){
  for(plr in c("POS", "NEG")){
    if(plr == "NEG"){
      ttl <- "Negative"
    } else if(plr == "POS"){
      ttl <- "Positive"
    }
    
    
    dt <- read.table(
      paste0(pth, "20210505_GRAPE_", clm, "_", plr, "_RT.txt"), 
      sep = "\t", na.strings = "N/A", skip = 3, row.names = 1)
    colnames(dt) <- "RT"
    dt$ID <- rownames(dt)
    dt  <- dt[!is.na(dt$RT),]
    
    dt$ID <- gsub("CER-H2O", "CER", dt$ID)
    dt$ID <- gsub("PC-COO", "PC", dt$ID)
    dt$ID <- gsub("_Na", "", dt$ID)
    
    dt <- merge(dt, cmps, by = "ID")
    dt$mass <- NA
    for(i in seq(nrow(dt))){
      dt$mass[i] <- MonoisotopicMass(formula = ListFormula(dt$formula[i]))
    }
    
    if(clm == "AMIDE"){
      rt <- 15
    } else {
      rt <- 26
    }
    
    dt_clm <- get(paste0("dt_", clm))
    
    #par(mfrow = c(1, 2))
    plot(dt$RT, dt$mass, pch = 21, xlab = "RT (min)", ylab = "m/z", xlim = c(0, rt), xaxt="n",
         bg = paste0(col_class[dt$class]), cex = 1.2, lwd = 0.01, 
         main = paste0(clm, " - ", ttl, " Analytes"))
    axis(1, at = seq(0, rt), labels = seq(0, rt))
    grid()
    idx <- dt_clm$name %in% dt$class
    text(as.numeric(dt_clm$RT[idx]), as.numeric(dt_clm$mass[idx]), 
         labels = dt_clm$name[idx], col = dt_clm$color[idx])
    
    #tmp_col <- col_class[names(col_class) %in% dt$class]
    #plot(1,1)
    #legend("topleft", legend = names(tmp_col), col = tmp_col, pch = 16)
  }
}
```


```{r, eval = FALSE}
text(dt_names$RT, dt_names$mass, dt_names$class, col = dt_names$col)


text(mean(dt$RT[dt$class == "FFA"])+0.5,
     mean(dt$mass[dt$class == "FFA"]),
     "FFA", col = col_class["FFA"])


plot(dt$RT, dt$mass, pch = 21, xlab = "RT (min)", ylab = "m/z", xlim = c(0, 15), xaxt="n",
     bg = paste0(col_class[dt$class]), cex = 1.2, lwd = 0.01, main = "Colonna XXX - Positive Analytes")
axis(1, at = seq(0, 15), labels = seq(0, 15))
grid()


plot(1,1)
legend("topright", legend=names(col_class), pch=20, col=col_class,bty='n')
```

